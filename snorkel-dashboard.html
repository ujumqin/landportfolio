<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enablement Effectiveness & ROI Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        /* Dashboard Grid Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Card Styling */
        .chart-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Make the heatmap span full width on bottom */
        .full-width {
            grid-column: span 2;
        }

        h3 {
            margin-top: 0;
            color: #34495e;
            font-size: 1.2rem;
        }

        .insight-box {
            background-color: #e8f6f3;
            border-left: 4px solid #1abc9c;
            padding: 10px 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #16a085;
            width: 90%;
            border-radius: 4px;
        }

        /* Tooltip styling */
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 6px;
            font-size: 12px;
            background: #333;
            color: #fff;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            .full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>

    <h1>Enablement Effectiveness & ROI Dashboard</h1>
    <div class="subtitle">Audience: VP of Engineering / HR Leadership</div>

    <div class="dashboard-container">
        
        <div class="chart-card">
            <h3>Time-to-Productivity (Trend)</h3>
            <div id="chart-trend"></div>
            <div class="insight-box">
                <strong>Insight:</strong> Onboarding redesign reduced ramp time from 45 days to 32 days.
            </div>
        </div>

        <div class="chart-card">
            <h3>Engagement vs. Retention</h3>
            <div id="chart-scatter"></div>
            <div class="insight-box">
                <strong>Insight:</strong> Positive correlation (r=.65) between continuous learning and high performance.
            </div>
        </div>

        <div class="chart-card full-width">
            <h3>Skill Gap Heatmap</h3>
            <div id="chart-heatmap"></div>
            <div class="insight-box">
                <strong>Action:</strong> Identifies where to allocate Q4 training budget (High Gaps in AI Ethics).
            </div>
        </div>

    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        // --- Shared Setup ---
        const tooltip = d3.select("#tooltip");
        const colors = {
            blue: "#3498db",
            purple: "#9b59b6",
            teal: "#1abc9c",
            dark: "#2c3e50"
        };

        // --- CHART A: Time-to-Productivity (Trend Line) ---
        function drawTrendChart() {
            const margin = {top: 20, right: 30, bottom: 40, left: 50},
                  width = 450 - margin.left - margin.right,
                  height = 300 - margin.top - margin.bottom;

            const svg = d3.select("#chart-trend")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Data
            const data = [
                {q: "Q1", days: 45},
                {q: "Q2", days: 40},
                {q: "Q3", days: 32}
            ];

            // X Axis
            const x = d3.scalePoint()
                .domain(data.map(d => d.q))
                .range([0, width])
                .padding(0.5);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Y Axis
            const y = d3.scaleLinear()
                .domain([20, 50])
                .range([height, 0]);

            svg.append("g")
                .call(d3.axisLeft(y));

            // Y Axis Label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text("Days to First Merge Request");

            // Line
            const line = d3.line()
                .x(d => x(d.q))
                .y(d => y(d.days));

            svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", colors.blue)
                .attr("stroke-width", 3)
                .attr("d", line);

            // Dots
            svg.selectAll("circle")
                .data(data)
                .enter().append("circle")
                .attr("cx", d => x(d.q))
                .attr("cy", d => y(d.days))
                .attr("r", 6)
                .attr("fill", colors.blue)
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`${d.q}: ${d.days} Days`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }

        // --- CHART B: Skill Gap Heatmap ---
        function drawHeatmap() {
            const margin = {top: 30, right: 30, bottom: 30, left: 100},
                  width = 800 - margin.left - margin.right,
                  height = 250 - margin.top - margin.bottom;

            const svg = d3.select("#chart-heatmap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const myGroups = ["Python", "Agile", "Leadership", "AI Ethics"];
            const myVars = ["Engineering", "Design", "QA", "Product"];

            // Data (Value 1 = Good/Green, Value 0 = Bad/Red Gap)
            const data = [
                {group: "Python", variable: "Engineering", value: 90},
                {group: "Agile", variable: "Engineering", value: 70},
                {group: "Leadership", variable: "Engineering", value: 40},
                {group: "AI Ethics", variable: "Engineering", value: 20},
                
                {group: "Python", variable: "Design", value: 10},
                {group: "Agile", variable: "Design", value: 85},
                {group: "Leadership", variable: "Design", value: 60},
                {group: "AI Ethics", variable: "Design", value: 50},

                {group: "Python", variable: "QA", value: 75},
                {group: "Agile", variable: "QA", value: 90},
                {group: "Leadership", variable: "QA", value: 30},
                {group: "AI Ethics", variable: "QA", value: 25},

                {group: "Python", variable: "Product", value: 30},
                {group: "Agile", variable: "Product", value: 95},
                {group: "Leadership", variable: "Product", value: 80},
                {group: "AI Ethics", variable: "Product", value: 60},
            ];

            // Build X scales and axis:
            const x = d3.scaleBand()
                .range([0, width])
                .domain(myGroups)
                .padding(0.05);
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x).tickSize(0))
                .select(".domain").remove();
            
            // Move X axis labels to top for better heatmap readability
            svg.append("g")
                .call(d3.axisTop(x).tickSize(0))
                .select(".domain").remove();

            // Build Y scales and axis:
            const y = d3.scaleBand()
                .range([height, 0])
                .domain(myVars)
                .padding(0.05);
            svg.append("g")
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove();

            // Build color scale (Red to Green)
            const myColor = d3.scaleLinear()
                .domain([0, 50, 100])
                .range(["#e74c3c", "#f1c40f", "#2ecc71"]);

            // Draw squares
            svg.selectAll()
                .data(data, function(d) {return d.group+':'+d.variable;})
                .enter()
                .append("rect")
                .attr("x", function(d) { return x(d.group) })
                .attr("y", function(d) { return y(d.variable) })
                .attr("width", x.bandwidth() )
                .attr("height", y.bandwidth() )
                .style("fill", function(d) { return myColor(d.value)} )
                .style("rx", 4)
                .style("ry", 4)
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`Score: ${d.value}/100`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                    d3.select(this).style("stroke", "black").style("opacity", 0.8);
                })
                .on("mouseout", function(d) {
                    tooltip.transition().duration(500).style("opacity", 0);
                    d3.select(this).style("stroke", "none").style("opacity", 1);
                });
        }

        // --- CHART C: Engagement vs. Retention (Scatter) ---
        function drawScatterChart() {
            const margin = {top: 20, right: 30, bottom: 40, left: 50},
                  width = 450 - margin.left - margin.right,
                  height = 300 - margin.top - margin.bottom;

            const svg = d3.select("#chart-scatter")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Generate Mock Data that shows positive correlation
            const data = [];
            for (let i = 0; i < 40; i++) {
                const hours = Math.floor(Math.random() * 50) + 5; // 5 to 55 hours
                // Performance is correlated to hours with some randomness
                const performance = 2 + (hours / 55) * 2.5 + (Math.random() * 0.5 - 0.25); 
                // clamp performance to max 5
                const finalPerf = Math.min(5, Math.max(1, performance)).toFixed(1);
                data.push({hours: hours, score: finalPerf});
            }

            // X Axis
            const x = d3.scaleLinear()
                .domain([0, 60])
                .range([0, width]);
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x));

            // X Label
            svg.append("text")
                .attr("text-anchor", "end")
                .attr("x", width/2 + margin.left)
                .attr("y", height + 35)
                .style("font-size", "12px")
                .text("Learning Hours Consumed");

            // Y Axis
            const y = d3.scaleLinear()
                .domain([1, 5])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));

             // Y Label
             svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text("Performance Review Score");

            // Dots
            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.hours); } )
                .attr("cy", function (d) { return y(d.score); } )
                .attr("r", 5)
                .style("fill", colors.purple)
                .style("opacity", 0.7)
                .style("stroke", "white");

            // Add simple trend line (visual approximation for correlation)
            svg.append("line")
                .attr("x1", x(5))
                .attr("y1", y(2.2))
                .attr("x2", x(55))
                .attr("y2", y(4.8))
                .attr("stroke", "gray")
                .attr("stroke-dasharray", "5,5")
                .attr("stroke-width", 2);
        }

        // Initialize Charts
        drawTrendChart();
        drawHeatmap();
        drawScatterChart();

    </script>
</body>
</html>